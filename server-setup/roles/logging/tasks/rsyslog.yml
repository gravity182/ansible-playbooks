---
- name: Create apps log directory
  ansible.builtin.file:
    path: /var/log/apps
    state: directory
    mode: "0755"
    owner: root
    group: adm
  become: true

- name: Deploy rsyslog application logging
  ansible.builtin.copy:
    src: rsyslog.d/99-application-logs.conf
    dest: /etc/rsyslog.d/99-application-logs.conf
    owner: root
    group: root
    mode: "0644"
    backup: "yes"
  become: true
  notify: Restart rsyslog

- name: Validate rsyslog configuration
  ansible.builtin.command:
    cmd: rsyslogd -N1
  changed_when: false
  become: true

- name: Ensure rsyslog service is enabled
  ansible.builtin.service:
    name: rsyslog
    enabled: true
  become: true
